name: 'Slurm Test'
description: 'Run slurm test suite'
inputs:
  tests:
    description: 'Tests to run'
    required: true
  options:
    description: 'Options to pass to futhark bench'
    required: false
    default: ''
  slurm:
    description: 'Options to pass to srun'
    required: false
    default: ''
runs:
  using: "composite"
  steps:
    - uses: actions/download-artifact@v3
      with:
        name: futhark-nightly-linux-x86_64.tar.xz
    - name: Setup compiler
      shell: bash
      run: |
        tar xvf futhark-nightly-linux-x86_64.tar.xz
    - name: Save slurmtest.py
      shell: bash
      run: |
        curl https://raw.githubusercontent.com/diku-dk/futhark-ci/slurm/slurmtest.py > slurmtest.py
    - name: Run tests
      shell: bash
      run: |
        python3.9 slurmtest.py \
          --futhark="$PWD/futhark-nightly-linux-x86_64/bin/futhark" \
          --tests=${{inputs.tests}} \
          ${{inputs.slurm}} \
          ${{inputs.options}}
